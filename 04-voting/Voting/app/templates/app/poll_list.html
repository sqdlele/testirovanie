{% extends "app/base.html" %}
{% block title %}Список опросов{% endblock %}

{% block extra_css %}
<style>
    .page-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; margin-bottom: 1.5rem; }
    .page-header h1 { margin: 0; }
    .poll-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1.25rem;
    }
    .poll-card {
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,.08);
        padding: 1.25rem 1.35rem;
        text-decoration: none;
        color: inherit;
        display: block;
        border: 1px solid rgba(0,0,0,.06);
        transition: box-shadow .2s, border-color .2s;
    }
    .poll-card:hover {
        box-shadow: 0 4px 20px rgba(0,0,0,.1);
        border-color: #4a6fa5;
    }
    .poll-card-title { font-size: 1.05rem; font-weight: 600; color: #1a1614; margin: 0 0 0.75rem; line-height: 1.4; }
    .poll-card-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem 1rem;
        font-size: 0.8rem;
        color: #666;
    }
    .poll-card-votes { color: #4a6fa5; font-weight: 600; }
    .poll-empty-card {
        grid-column: 1 / -1;
        padding: 3rem 2rem;
        color: #888;
        background: #f8f9fa;
        border-radius: 10px;
        border: 1px dashed #ccc;
    }
    .poll-empty-card p { margin: 0 0 0.75rem; }
    @media (max-width: 900px) {
        .poll-grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 560px) {
        .poll-grid { grid-template-columns: 1fr; }
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Опросы</h1>
    {% if user.is_authenticated %}
    <a href="{% url 'poll_create' %}" class="btn btn-primary">+ Создать опрос</a>
    {% else %}
    <a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-ghost">Войдите, чтобы создать опрос</a>
    {% endif %}
</div>

<div class="poll-grid">
    {% for poll in polls %}
    <a href="{% url 'poll_detail' poll.pk %}" class="poll-card">
        <h2 class="poll-card-title">{{ poll.question }}</h2>
        <div class="poll-card-meta">
            <span class="poll-card-votes">{{ poll.total_votes }} голосов</span>
            {% if poll.created_by %}
            <span>{{ poll.created_by.username }}</span>
            {% else %}
            <span>Гость</span>
            {% endif %}
            <span>{{ poll.created_at|date:"d.m.Y" }}</span>
        </div>
    </a>
    {% empty %}
    <div class="poll-empty-card">
        <p>Пока нет опросов.</p>
        {% if user.is_authenticated %}
        <a href="{% url 'poll_create' %}" class="btn btn-primary">Создать первый</a>
        {% else %}
        <a href="{% url 'register' %}" class="btn btn-primary">Зарегистрироваться</a>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% endblock %}
